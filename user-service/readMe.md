1. 我们需要给我们的接口定义下返回值的格式 code，context，message，
并且给一些responseUtils和responseCode。 我们会定义到common模块中

2. user service pom和配置的更新（粮草先行）

2.x 我们先将 redistemplate + redis processor 类  和 resttemplate这两个配置类进行书写

3. username + password的一个注册（看不上这个注册）
   是基于oauth2的注册，需要有username， password， clientid，clientsecret。直接让你登录，
   携带token信息。

   收到用户名和密码后你应该如何？
   （1）。将user信息存入 user表
   （2）存一张 clients表   refresh_token,password
   （3）你存进去了就行了？这是两张表，互相有配合的，需要用事务
   （4）新用户注册完成：通过这些信息直接访问 oath2 service进行token的获取
   （5）将用户信息和token信息一同返回给前端，并且用户信息需要存储到redis中，需要用户信息的一个key，
   这个key我们采用虚拟的personId进行，personId = 当前用户的数据库id + 10000000

4. phone number + 验证码的注册形式。
   -- 首先客户端发送手机号给后台；
   -- 后台接到手机号后，后台生成随机验证码，将手机号和验证码同时发送给第三方短信平台（腾讯）的同时
      将手机号和code存入redis 数据库，设置5分钟过期
   -- 客户端发送 手机号和收到的验证码访问后台，后台接到后，查询redis数据库，是否code匹配，如果匹配则
      将该手机用户进行oauth2的注册，完成注册后，无需再次登录，直接返回我们token信息以及当前用户的用户信息
   -- 用户信息也是需要存储到redis缓存的，因为很多时候我们需要使用用户信息，比如说：查看当前用户是否
      完成了实名认证、是否是vip等等，我们通过redis进行访问
   为了实现phone number + 验证码，我们需要在此额外搞一个 sms 模块，专门用于发短信的。（当前我们看到的
   可能仅仅是为了用户注册登录，将来，我们会有一些短信推送业务，都可以走sms）

   校长没有自己花钱买短信服务，我们只给伙伴们演示代码开发。对于phonenumber和验证码存入redis这部分的内容，
   我们手动进行。

5. 进行第三方账号登录。我想用我当前的 GITEE （之所以无法选择微信或qq，是因为校长是
本人的个人用户，申请微信和qq这种很难，几乎不太可能，所以我们用GITEE代替，原理是一样的）
账号进行系统的登录。

![img.png](img.png)

===============================以上是第一部分无需集成 canal=====================================================

===============================以下是第二部分 需集成 canal=====================================================
canal的应用场景十分多，我们目前仍然处于项目初期，所以我们需要等到有canal应用场景的时候，才能看到canal的功效。
现在有没有需要使用canal的地方呢？

有，很重要的地方。
现有场景：我们初始用户登录了，比如说用第三方账号登录了；有的项目，登录之后，要求用户进行 phonenumber绑定。
前端就会调用后端的一个check phonestatus 接口，进行检索，是否绑定了phoneNumber。
如果没有绑定，就强制要求（软性提示用户进行phoneNumber的绑定），绑定phoneNumber之后，我们需要更新mysql的user表；
此时缓存中必须要保证一致性，我们就用canal进行缓存删除；

再比如，用户购买了vip，我们更新了数据库，如果redis不同步，那么用户就会投诉。

再开始使用canal之前，我们需要添加两个接口
1. check phone bind status
2. bind phone
后续慢慢的，随着业务的增长，比如到后边我们需要进行支付功能，我们就会写idcard绑定，还会用canal，后续开vip，还会用，后续慢慢的你会发现 
   canal的使用场景会逐步增多


